---
title: "nyc_housing"
author: "Anubhav Maini"
date: "February 21, 2018"
output: html_document
---
Anubhav Maini, Eric Moyal, Monica Katoch, Harshil Dwivedi
Marketing Analytics
Professor Ranjan
February 21, 2018
Git Link- https://github.com/anumaini/housing_data

New York Mortgage Decisions 

The data problem is what variables are necessary to predict mortgage decisions based on the variables provided in “ny_hmda_2015.csv” such as race, gender, and income. The managerial objective is to obtain an accurate model to predict the outcome of mortgage decisions. Further, we can assess which variables are more pertinent to make this assessment. 

2. Here's how we assessed the dataset: 

```{r eval=FALSE, include=FALSE}

housing_data <- read.csv(file.choose(), header=T)
library(dplyr)
library(ggplot2)
library(tidyr)

#Understanding the Data 
names(housing_data)
summary(housing_data)
str(housing_data)
```

Using sapply to assess class of data and creating a data frame for future reference. 

```{r}
#Understanding classes of all variables 

Variable_names <- data.frame(sapply(housing_data, class))
Variable_names <- rename(Variable_names, data_class= sapply.housing_data..class.)
Variable_names$num <- 1:78
print(Variable_names)
```

Understanding levels for factor type variables in the data set: 

```{r}
Variable_factor <- Variable_names%>% filter(data_class == "factor") 
factor <- Variable_factor$num
```

The table Variable_names explains what each variable type is. And those variables with factors/levels are explained in table Variable_factors.    

3. Now, we move on to understand the statistics of Data:

```{r}
ratio <- c(8, 23, 71, 72, 73, 74,75,76,78) #these are Ratio Variables
#inspecting and learning about ratio variables 
variable_stat <- data.frame(summary(housing_data[, ratio], na.rm=TRUE))

#Inspecting IQR's

IQR(housing_data$applicant_income_000s, na.rm=TRUE)
IQR(housing_data$applicant_income_000s, na.rm=TRUE)
IQR(housing_data$census_tract_number, na.rm=TRUE)
IQR(housing_data$hud_median_family_income, na.rm=TRUE)
IQR(housing_data$loan_amount_000s, na.rm=TRUE)
IQR(housing_data$number_of_1_to_4_family_units, na.rm=TRUE)
IQR(housing_data$number_of_owner_occupied_units, na.rm=TRUE)
IQR(housing_data$minority_population, na.rm=TRUE)
IQR(housing_data$population, na.rm=TRUE)
IQR(housing_data$tract_to_msamd_income, na.rm=TRUE)

#Inspecting SD's
sd(housing_data$applicant_income_000s, na.rm=TRUE)
sd(housing_data$census_tract_number, na.rm=TRUE)
sd(housing_data$hud_median_family_income, na.rm=TRUE)
sd(housing_data$loan_amount_000s, na.rm=TRUE)
sd(housing_data$number_of_1_to_4_family_units, na.rm=TRUE)
sd(housing_data$number_of_owner_occupied_units, na.rm=TRUE)
sd(housing_data$minority_population, na.rm=TRUE)
sd(housing_data$population, na.rm=TRUE)
sd(housing_data$tract_to_msamd_income, na.rm=TRUE)

```

4. We handled missing data in two ways: 

For data that was missing, we added na.rm=TRUE to the IQR() and sd() methods. This omits the data from the calculation so the method can accurately calculate the interquartile range and standard deviations. 

Also, we can convert blanks to NA in the entire data set at the beginning of the beggining of the assessment. 

```{r}
Variables <- variable.names(housing_data) # converting all variable names to  
housing_data <- data.frame(ifelse(housing_data %in% c(""," ","NA"), NA, housing_data))#Treating blanks and reconverting list to Data Frame 
# renaming the strings
colnames(housing_data) <- Variables  
```

5. Assesing the variables using data vasualization techniques- 

```{r}
#gender filter
housing_data_filtered <- filter(housing_data,applicant_sex_name =="Male" | applicant_sex_name == "Female") %>% 
  droplevels()

#ethnicity filter
housing_data_filtered <- filter(housing_data_filtered,
                      applicant_ethnicity_name == "Not Hispanic or Latino" | 
                        applicant_ethnicity_name == "Hispanic or Latino") %>% 
  droplevels()


#histogram of gender
housing_data_gender <- housing_data_filtered %>% 
  group_by(applicant_sex_name) %>%
  summarise(gender_count = n()) 

ggplot(housing_data_gender, aes(applicant_sex_name, gender_count)) +
  geom_bar(stat = 'identity') +ggtitle("Histogram of Gender")+xlab("Gender")+ylab("Frequency")

#histogram of ethnicity
housing_data_ethnicity <- housing_data_filtered %>% 
  group_by(applicant_ethnicity_name) %>%
  summarise(ethnicity_count = n()) 

ggplot(housing_data_ethnicity, aes(applicant_ethnicity_name, ethnicity_count))+
  geom_bar(stat = 'identity') + ggtitle("Histogram of Ethnicity")+xlab("Ethnicity")+ylab("Frequency")

#histogram by loan type
housing_data_loan <- housing_data_filtered %>% 
  group_by(loan_type_name) %>%
  summarise(loan_count = n()) 

ggplot(housing_data_loan, aes(loan_type_name, loan_count)) +
  geom_bar(stat = 'identity') + ggtitle("Histogram of Loan Type")+xlab("Loan Type")+ylab("Frequency")

```
Key Insights: 

a) There are almost twice as many male applicants than female applicants 
b) Significantly lower Hispanic or Latino Applicants in the pool( these only factor those who disclosed)
c) Conventional Loan applications are the highest followed by FHA insured, VA-guaranteed, and FSA/RHS guaranteed 

6. Bivariate frequency distributions (tables or plots) for key variables

```{r}
#frequency table for loan type and ethnicity
head(factor(housing_data_filtered$applicant_ethnicity_name))
FreqTable <- table(housing_data_filtered$applicant_ethnicity_name,housing_data_filtered$loan_type_name)
plot(FreqTable, las = 2)

## We understand the distribution of data basis ethnicity and loan type. Conventional non Hispanic or Latino applicants are the largest in this data set. Other three loan types follow suit as per the bi-variate Frequecy table. 

# to observe the relation between loan amount and applicant's income
plot(housing_data_filtered$loan_amount_000s ~ housing_data_filtered$applicant_income_000s, main="Scatterplot of loan amount and applicant's income",xlab="Income(in thousands)",ylab="Loan Amount(in thousands)")

#As you can observe that there is a higher concentration of lower loan amounts as a factor of lower income. Although there are instances where the loan amounts for the same income are higher/audacious(in the real world), these outliers make a small portion of the data.   

# bivariate plot for relationship between applicant's income (mean) and loan amount (mean) by loan type
housing_data_agg <- aggregate(housing_data_filtered, list(housing_data_filtered$loan_type_name), mean, na.rm=TRUE)
ggplot(housing_data_agg, aes(applicant_income_000s, loan_amount_000s)) + geom_point() +
  geom_text(aes(label=housing_data_agg$Group.1))

#on working with averages for loan amount and income and factoring the loan type, we notice that conventional loan averages as a factor of mean income and loan are diagnoally dispered in the graph when compared to HS guarenteed. This means that the HS guarenteed applicants have lesser incomes and also apply for lower loan amounts, which in the real word makes sense. We can draw conclusions accordingly for the other two as they lie in between these plots. 

# bivariate plot for relationship between applicant's income (mean) 
# and loan amount (mean) by ethnicity
housing_data_agg <- aggregate(housing_data_filtered, list(housing_data_filtered$applicant_ethnicity_name), mean, na.rm=TRUE)

ggplot(housing_data_agg, aes(applicant_income_000s, loan_amount_000s)) + geom_point() +
  geom_text(aes(label=housing_data_agg$Group.1))

#on doing a similar analysis as above between income and loans on the basis of ethnicity, we learn that those applicants who identify as Hispanic or Latino have lower incomes and apply for high loan amounts. The contrary is observed for those who did not identify with this ethnicity.

```


```{r}
#Corelation between chosen variables: 


```



7. 



